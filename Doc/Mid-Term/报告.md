# 赛题概述

主要是实现一个脚本管控，基于文件系统的安全扩展属性及LSM安全框架。具体体现为对文件进行标识，标识为非法标识的文件不允许执行，只有被标识为合法标识的文件才允许被实行。除了对于最基础的二进制文件的处理，进阶任务是1）对于包括shell（bash、dash）、python、php、perl、java、awk等解释性语言编写的文件或程序，覆盖的语言越多越好；2）脚本管道或重定向执行控制。

# 问题分解

<font color="#dd0000">或许这个地方可以加上我们的基础假设</font><br />


<font color="#dd0000">还有文件的三种状态（未标记、verified、unknown）的那个转化图</font><br />

## 二进制程序执行控制

### 创建文件的监控

1. 监控新文件的创建过程（检测到发生）
2. 非法标识的设置

<font color="#dd0000">创建文件是不会被监控的，当然此过程只能创建出空文件</font><br />

### 移动文件的监控

合法标识文件移动后，在新路径下的文件，默认不允许执行

1. 监控文件的移动
2. 判断当前路径是否与原路径不同<font color="#dd0000">这种方法太麻烦了，而且会出现漏洞，所以不如之间判断是否发生移动</font><br />
3. 给移动到新路径的文件设置非法标识

<font color="#dd0000">移动过程中，一定有软硬连接的变化，这个过程会被抓到。</font><br />

<font color="#dd0000">其实这个地方我们还没有实现（（（（，但按照黑皮书的说法应该是这个样子的。那就先当作我们实现了吧</font><br />
### 修改文件的监控

1. 监控文件的修改这一动作的发生
2. 判断文件内容是否发生修改<font color="#dd0000">这种方法太麻烦了，而且会出现漏洞，所以不如之间判断是否尝试修改</font><br />
3. 发生修改要打非法标记

<font color="#dd0000">修改文件时会调用write的钩子，于是进行扩展属性的改变</font><br />
### LSM模块——不允许非法标识的程序执行

LSM的设计思想：在最少改变内核代码的情况下，提供一个能够成功实现强制访问控制模块需要的结构或者接口。

[参考资料]: https://blog.csdn.net/qq_34412985/article/details/106541598

## 脚本文件常规执行控制

ftrace

<font color="#dd0000">这个我们不大会，靠你了</font><br />&#x1F44D;
#### 初步想法：


### 和二进制文件的区别

### 不同语言编写的脚本有什么不同

## 脚本管道或重定向执行控制

### 重定向操作

使用重定向操作可以改变输入输出内容的方向，而不使用默认键盘和屏幕设备。

![image-20220428173055454](C:\Users\16038\AppData\Roaming\Typora\typora-user-images\image-20220428173055454.png)
<font color="#dd0000">这里没发原图我们也不清楚是个什么（（（（（</font><br />
#### 初步想法：

是shell脚本的基本功能，可以借鉴它的实现方式。我的猜测是文件操作的组合。

### 管道操作

管道操作可以使不同命令之间协同操作，管道符号左侧的结果作为右侧命令的处理对象

```bash
cat test.sh | sh
```

#### 初步想法： 

找到指令的正确执行顺序，并且要存储上一条指令的结果、执行下一条指令时调用上一条指令的结果